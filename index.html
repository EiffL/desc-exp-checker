<!DOCTYPE html>
<html>
<head>
  <title>DES exposure checker</title>
  <link rel="stylesheet" media="screen" href="assets/bootstrap/css/bootstrap.min.css" type="text/css" charset="utf-8">
  <meta charset="utf-8">
  <meta name="author" content="Peter Melchior, Erin Sheldon">
  <link rel="icon" href="assets/DES_logo_trans.png" type="image/png">
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script>
  var email = "???";
  var domain = "???";
  </script>
  <style>
  .container {width: 980px; }
  body,html { height: 100%; }
  #wrapper {min-height: 100%; height: auto !important; height: 100%; margin: 0 auto -60px;}
  #foot, #push { height: 60px; clear: both; }
  </style>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>

<body>
  <div id="wrapper">
  <div class='container'>
    <div class="hero-unit">
    <h1>DES exposure checker</h1>
    <p>See how DES images actually look like. Discover flaws we would otherwise have missed. Make our data better.</p>
    <p><button class="btn btn-primary btn-large" id="open-login-button">Log in</button></p>
    </div>
    <div class="span8">
      <h4>Introduction</h4>
      <p>The purpose of the application is to provide easy access to the DES firstcut
      images. Well, not exactly the firstcut images. What you see here are factor 4
      downsampled versions of the actual images just to keep the loading times
      tolerable &mdash; the same goes for the image size, unless you are working
      on a 4096 pixel wide monitor.</p>
      <h4>What's the goal of this?</h4>
      <p>We all want to conduct a science analysis based on the DES data. However,
      no data is perfect, so we need to know what kinds of image artifacts are
      in our data because, ultimatively, all of them need  to be accounted for
      in one way or another. This application helps in two ways:</p>
      <ul>
        <li>It gives a convenient visual impression of the actual DES data and
        some of the processing steps that have already attempted to identify and
        mask artifacts.</li>
        <li>It enables everyone to search for undetected artifacts. We gather your
        submissions, analyze them, and feed them back to the science working groups
        and DESDM. This way, we can train the processing pipelines on flaws, of
        which we know they are there.</li>
      </ul>
      <h4>How can I start?</h4>
      Check out our <a href="tutorial.html">Tutorial</a> and you'll know what to do in no time.
      <h4>How are we doing so far?</h4>
      The basic <a href="statistics.html">statistics</a> are computed in real time. More
      detailed analyses will become available once we have gathered enough submissions.
    </div>
    <div class="span4">
      <h4>Leaderboard</h4>
      <div id="leaderboard"></div>
      <h4>Progress to date</h4>
      <div style="text-align: center"><div id="basic_stats"></div></div>
    </div>
  </div>
  
  <!-- Login modal -->
  <div class="modal hide" id="logIn">
      <div class="modal-header">
	<a class="close" data-dismiss="modal">x</a>
	<h3>Log in</h3>
      </div>
      <div class="modal-body">
	<form id="log-in-form" class="form-horizontal" style="margin-bottom: 0px;">
	  <fieldset>
	    <div class="control-group">
	      <label class="control-label" for="username">Account name</label>
	      <div class="controls">
		<input type="text" class="input" id="username" name="username" style="background-color: rgb(255, 255, 204);">
	      </div>
            </div>
	    <div class="control-group">
	      <label class="control-label" for="hash">Password</label>
	      <div class="controls">
		<input type="password" class="input" name="hash" style="background-color: rgb(255, 255, 204);">
	      </div>
	    </div>
	  </fieldset>
	</form>
      </div>
      <div class="modal-footer">
        <!--div class="form-actions" style="margin-bottom: 0px;"-->
          <button class="btn btn-success" id="login_button" data-toggle="button" data-loading-text="Authenticating...">Log in</button>
          &nbsp;&nbsp;
          <script>
          document.write('<a title="How to get your password resetted" href="mailto:' + email + '@' + domain + '?subject=Please%20reset%20my%20password&body=To%20get%20your%20password%20resetted,%20simply%20send%20this%20email%20from%20the%20email%20account%20you%20used%20when%20signing%20up.">Forgot password?</a>');
          </script>
        <!--/div-->
      </div>
  </div>
    <div id="push"></div>
  </div>
  <div id="foot">
    <div class="container" style="text-align:right">
      <div class="breadcrumb muted" style="margin: 24px 0 0 0;">Created by Peter Melchior and Erin Sheldon</div>
    </div>
  </div>
</body>
<script src="assets/sha1.js"></script>
<script type="text/javascript" src="assets/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="assets/jquery.cookie.js"></script>
<script src="assets/login.js" type="text/javascript"></script>
<script type="text/javascript" src="assets/bootstrap/js/bootstrap.min.js"></script>
<script>
  $(document).ready(function () {
    $.get('ranking.php', {'limit': 10, 'output': 'html', 'short':true}, function(response) {
      $('#leaderboard').html(response);
    });
  });
  $('#logIn').modal({"show": false });
  $('#login_button').on('click', logIn).button();
  
  function checkSessionCookie() {
    return ($.cookie('sid') != null);    
  }
  $('#open-login-button').on('click', function() {
      if (checkSessionCookie())
        window.location.href = "viewer.html";
      else
        $('#logIn').modal('show');
  });
</script>

<script>      
var radius1 = 100;
var arc1 = d3.svg.arc()
    .outerRadius(radius1)
    .innerRadius(radius1 - 40);
var pie = d3.layout.pie();

d3.json("stats.php", function(error, response) {
  
  // checked chart
  var svg = d3.select("#basic_stats").append("svg")
    .attr("width", radius1*2)
    .attr("height", radius1*2);
    
  var g = svg.selectAll(".arc")
    .data(pie([response.done/response.total, (response.total - response.done)/response.total]))
    .enter().append("g")
      .attr("transform", "translate(" + radius1 + "," + radius1 + ")");
  g.append("path")
    .attr("class", "arc")
    .attr("d", arc1)
    .style("fill", function(d, i) { if (i == 0) return '#000'; else return '#eee'; });
  g.append("text")
    .attr("transform", function(d) { return "translate(" + arc1.centroid(d) + ")"; })
    .attr("dy", ".35em")
    .style("text-anchor", "middle")
    .style("fill", "#fff")
    .style("font-size", "10px")
    .text(function(d, i) { if (i==0 && d.data > 0.05) return (100*d.data).toString().split(".").shift() + '%'; else return null; });
  svg.append("text")
    .attr("dy", ".35em")
    .attr("transform", "translate(" + radius1 + "," + radius1 + ")")
    .style("text-anchor", "middle")
    .text("Checked");
});
</script>

</html>
